<ion-header>
    <ion-toolbar color="light">
        <ion-title>Trade Hub</ion-title>
        <ion-buttons slot="end">
            <ion-button (click)="navCtrl.navigateRoot('')"><ion-icon slot="start" name="log-out"></ion-icon>Logout</ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>
<ion-content>
    <ion-toolbar color="highlight">
        <ion-segment (ionChange)="switchSegment($event)">
            <ion-segment-button value="inbox" checked>
                <ion-label>Inbox</ion-label>
            </ion-segment-button>
            <ion-segment-button value="outbox">
                <ion-label>Outbox</ion-label>
            </ion-segment-button>
            <ion-segment-button value="archive">
                <ion-label>Archive</ion-label>
            </ion-segment-button>
        </ion-segment>
    </ion-toolbar>
    <!--Incoming-->
    <div *ngIf="segment === 'inbox'">
        <ion-card color="light-alt">
            <ion-card-header color="medium-light">
                <ion-card-title>Trades</ion-card-title>
            </ion-card-header>
            <ion-card-content no-padding>
                <div text-center>
                    <div padding *ngIf="inbox.trades && inbox.trades.length == 0 && !inboxIsLoading">No Trades</div>
                    <ion-spinner *ngIf="inboxIsLoading" margin></ion-spinner>
                </div>
                <ion-list *ngIf="inbox.trades && inbox.trades.length > 0 && !inboxIsLoading" lines="none" no-padding>
                    <ion-item color="light-alt">
                        <ion-grid no-padding>
                            <ion-row>
                                <ion-col size="6"><strong>Partner</strong></ion-col>
                                <ion-col size="3" text-center><strong>Trade</strong></ion-col>
                                <ion-col text-right><strong>Proposed</strong></ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-item>
                    <ion-item *ngFor="let in of inbox.trades" (click)="viewTrade(in.trade_id)">
                        <ion-grid no-padding>
                            <ion-row class="ion-align-items-center">
                                <ion-col size="6">{{in.dba}}</ion-col>
                                <ion-col size="3" class="ion-justify-content-evenly ion-align-items-center" style="display:flex;">{{in.rec_valu}} <ion-icon name="repeat" size="small"></ion-icon> {{in.init_valu}}</ion-col>
                                <ion-col text-right>{{in.trade_proposed | date:'shortDate'}}</ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-item>
                </ion-list>
            </ion-card-content>
        </ion-card>
        <ion-card color="light-alt">
            <ion-card-header color="medium-light">
                <ion-card-title>Invoices</ion-card-title>
            </ion-card-header>
            <ion-card-content no-padding>
                <div text-center>
                    <div padding *ngIf="inbox.invoices && inbox.invoices.length == 0 && !inboxIsLoading">No Invoices</div>
                    <ion-spinner *ngIf="inboxIsLoading" margin></ion-spinner>
                </div>
                <ion-list *ngIf="inbox.invoices && inbox.invoices.length > 0 && !inboxIsLoading" lines="none" no-padding>
                    <ion-item color="light-alt">
                        <ion-grid no-padding>
                            <ion-row>
                                <ion-col size="6"><strong>Partner</strong></ion-col>
                                <ion-col size="3" text-center><strong>Invoice</strong></ion-col>
                                <ion-col text-right><strong>Proposed</strong></ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-item>
                    <ion-item *ngFor="let in of inbox.invoices" (click)="viewTrade(in.trade_id)">
                        <ion-grid no-padding>
                            <ion-row class="ion-align-items-center">
                                <ion-col size="6">{{in.dba}}</ion-col>
                                <ion-col size="3" class="ion-justify-content-evenly ion-align-items-center" style="display:flex;">{{in.init_valu}}</ion-col>
                                <ion-col text-right>{{in.trade_proposed | date:'shortDate'}}</ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-item>
                </ion-list>
            </ion-card-content>
        </ion-card>
        <ion-card color="light-alt">
            <ion-card-header color="medium-light">
                <ion-card-title>Gifts</ion-card-title>
            </ion-card-header>
            <ion-card-content no-padding>
                <div text-center>
                    <div padding *ngIf="inbox.gifts && inbox.gifts.length == 0 && !inboxIsLoading">No Gifts</div>
                    <ion-spinner *ngIf="inboxIsLoading" margin></ion-spinner>
                </div>
                <ion-list *ngIf="inbox.gifts && inbox.gifts.length > 0 && !inboxIsLoading" lines="none" no-padding>
                    <ion-item color="light-alt">
                        <ion-grid no-padding>
                            <ion-row>
                                <ion-col size="6"><strong>Partner</strong></ion-col>
                                <ion-col size="3" text-center><strong>Gift</strong></ion-col>
                                <ion-col text-right><strong>Proposed</strong></ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-item>
                    <ion-item *ngFor="let in of inbox.gifts" (click)="viewTrade(in.trade_id)">
                        <ion-grid no-padding>
                            <ion-row class="ion-align-items-center">
                                <ion-col size="6">{{in.dba}}</ion-col>
                                <ion-col size="3" class="ion-justify-content-evenly ion-align-items-center" style="display:flex;">{{in.init_valu}}</ion-col>
                                <ion-col text-right>{{in.trade_proposed | date:'shortDate'}}</ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-item>
                </ion-list>
            </ion-card-content>
        </ion-card>
    </div>
    <div *ngIf="segment === 'outbox'">
        <!--Outgoing-->
        <ion-card color="light-alt">
            <ion-card-content no-padding>
                <div text-center margin *ngIf="outbox.length == 0 || outboxIsLoading">
                    <span *ngIf="outbox.length == 0 && !outboxIsLoading">No trades in outbox</span>
                    <ion-spinner *ngIf="outboxIsLoading"></ion-spinner>
                </div>
                <ion-list *ngIf="outbox.length > 0 && !outboxIsLoading" lines="none" no-padding>
                    <ion-item color="medium-light">
                        <ion-grid no-padding>
                            <ion-row>
                                <ion-col size="6"><strong>Partner</strong></ion-col>
                                <ion-col size="3" text-center><strong>Trade</strong></ion-col>
                                <ion-col text-right><strong>Proposed</strong></ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-item>
                    <ion-item *ngFor="let out of outbox; let i = index" (click)="viewTrade(out.trade_id)" [color]="i % 2 ? 'medium-light' : 'light-alt'">
                        <ion-grid no-padding>
                            <ion-row class="ion-align-items-center">
                                <ion-col size="6">{{out.dba}}</ion-col>
                                <ion-col size="3" class="ion-justify-content-evenly ion-align-items-center" style="display:flex;">{{out.init_valu}} <ion-icon name="repeat" size="small"></ion-icon> {{out.rec_valu}}</ion-col>
                                <ion-col text-right>{{out.trade_proposed | date:'shortDate'}}<br/>{{out.trade_proposed | date:'shortTime'}}</ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-item>
                </ion-list>
            </ion-card-content>
        </ion-card>
    </div>
    <div *ngIf="segment == 'archive'">
        <ion-card color="light-alt">
            <ion-card-content no-padding>
                <div text-center margin *ngIf="archive.length == 0 || archiveIsLoading">
                    <span *ngIf="archive.length == 0 && !archiveIsLoading">No trades in archive</span>
                    <ion-spinner *ngIf="archiveIsLoading"></ion-spinner>
                </div>
                <div style="overflow-x:auto">
                <ion-list *ngIf="archive.length > 0 && !archiveIsLoading" lines="none" no-padding>
                    <ion-item color="medium-light">
                        <ion-grid no-padding>
                            <ion-row>
                                <ion-col size="4"><strong>Partner</strong></ion-col>
                                <ion-col size="3" text-center><strong>Trade</strong></ion-col>
                                <ion-col size="3"><strong>Status</strong></ion-col>
                                <ion-col size="2" text-right><strong>Date</strong></ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-item>
                    <ion-item *ngFor="let arch of archive; let i = index" (click)="viewTrade(arch.trade_id)" [color]="i % 2 ? 'medium-light' : 'light-alt'">
                        <ion-grid no-padding>
                            <ion-row class="ion-align-items-center">
                                <ion-col size="4" *ngIf="vars.merchantData['dba'] === arch.init_dba">{{arch.rec_dba}}</ion-col>
                                <ion-col size="4" *ngIf="vars.merchantData['dba'] === arch.rec_dba">{{arch.init_dba}}</ion-col>
                                <ion-col size="3" class="ion-justify-content-evenly ion-align-items-center" style="display:flex;">{{arch.init_valu}} <ion-icon name="repeat" size="small"></ion-icon> {{arch.rec_valu}}</ion-col>
                                <ion-col size="3">{{arch.trade_status}}</ion-col>
                                <ion-col size="2" text-right>{{arch.trade_completed | date:'shortDate'}}</ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-item>
                </ion-list>
                </div>
            </ion-card-content>
        </ion-card>
    </div> 
    <!--Start New Trade-->
        <ion-fab vertical="bottom" horizontal="end" slot="fixed">
            <ion-button size="large" shape="round" color="light" (click)="startNewTrade()">
                <ion-icon name="add" slot="start"></ion-icon>
                <ion-label>New</ion-label>
            </ion-button>
        </ion-fab>
</ion-content>